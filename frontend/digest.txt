Directory structure:
‚îî‚îÄ‚îÄ livekit-react-app/
    ‚îú‚îÄ‚îÄ Dockerfile
    ‚îú‚îÄ‚îÄ index.html
    ‚îú‚îÄ‚îÄ package.json
    ‚îú‚îÄ‚îÄ tsconfig.json
    ‚îú‚îÄ‚îÄ tsconfig.node.json
    ‚îú‚îÄ‚îÄ vite.config.ts
    ‚îú‚îÄ‚îÄ .env.local
    ‚îî‚îÄ‚îÄ src/
        ‚îú‚îÄ‚îÄ App.css
        ‚îú‚îÄ‚îÄ App.tsx
        ‚îú‚îÄ‚îÄ index.css
        ‚îî‚îÄ‚îÄ main.tsx

================================================
File: Dockerfile
================================================
# React Frontend Dockerfile - With environment variables at build time
FROM node:18-alpine as builder

WORKDIR /app

# Copy package files
COPY ./package*.json ./
RUN npm ci

# Copy source files INCLUDING the .env we just created
COPY ./ .

# The .env file is now available during build
RUN npm run build

# Production stage
FROM node:18-alpine

RUN npm install -g serve

WORKDIR /app

# Copy built files from builder stage
COPY --from=builder /app/dist ./

EXPOSE 3000

CMD ["serve", "-s", ".", "-l", "3000"]


================================================
File: index.html
================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LiveKit Voice Assistant</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>


================================================
File: package.json
================================================
{
    "name": "livekit-voice-assistant",
    "version": "0.1.0",
    "private": true,
    "dependencies": {
      "@livekit/components-react": "^2.0.0",
      "@livekit/components-styles": "^1.0.0",
      "livekit-client": "^2.0.0",
      "react": "^18.2.0",
      "react-dom": "^18.2.0",
      "axios": "^1.6.0"
    },
    "devDependencies": {
      "@types/react": "^18.2.0",
      "@types/react-dom": "^18.2.0",
      "@vitejs/plugin-react": "^4.2.0",
      "typescript": "^5.3.0",
      "vite": "^5.0.0"
    },
    "scripts": {
      "dev": "vite",
      "build": "vite build",
      "preview": "vite preview"
    }
  }


================================================
File: tsconfig.json
================================================
{
    "compilerOptions": {
      "target": "ES2020",
      "useDefineForClassFields": true,
      "lib": ["ES2020", "DOM", "DOM.Iterable"],
      "module": "ESNext",
      "skipLibCheck": true,
      "moduleResolution": "bundler",
      "allowImportingTsExtensions": true,
      "resolveJsonModule": true,
      "isolatedModules": true,
      "noEmit": true,
      "jsx": "react-jsx",
      "strict": true,
      "noUnusedLocals": true,
      "noUnusedParameters": true,
      "noFallthroughCasesInSwitch": true,
      "types": ["vite/client"]
    },
    "include": ["src"],
    "references": [{ "path": "./tsconfig.node.json" }]
  }


================================================
File: tsconfig.node.json
================================================
{
    "compilerOptions": {
      "composite": true,
      "skipLibCheck": true,
      "module": "ESNext",
      "moduleResolution": "bundler",
      "allowSyntheticDefaultImports": true,
      "strict": true
    },
    "include": ["vite.config.ts"]
  }


================================================
File: vite.config.ts
================================================
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  server: {
    port: 3000,
    open: true
  }
})


================================================
File: .env.local
================================================
VITE_LIVEKIT_URL=ws://localhost:7880
VITE_ORCHESTRATOR_URL=http://localhost:8080


================================================
File: src/App.css
================================================
/* App.css - Copy this entire content to src/App.css */

.app {
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }
  
  .connect-container {
    background: white;
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    max-width: 500px;
    width: 100%;
  }
  
  .connect-container h1 {
    text-align: center;
    color: #333;
    margin-bottom: 10px;
    font-size: 2.5em;
  }
  
  .connect-container p {
    text-align: center;
    color: #666;
    margin-bottom: 30px;
  }
  
  .connect-form {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  
  .form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  
  .form-group label {
    font-weight: 600;
    color: #555;
    font-size: 14px;
  }
  
  .form-group input {
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 16px;
    transition: border-color 0.3s;
  }
  
  .form-group input:focus {
    outline: none;
    border-color: #667eea;
  }
  
  .start-button {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 10px;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.3s, box-shadow 0.3s;
    margin-top: 10px;
  }
  
  .start-button:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
  }
  
  .start-button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
  
  .error-message {
    background: #fee;
    color: #c33;
    padding: 12px;
    border-radius: 8px;
    text-align: center;
    margin-top: 10px;
  }
  
  .info-box {
    background: #f7f9fc;
    border-radius: 10px;
    padding: 20px;
    margin-top: 30px;
  }
  
  .info-box h3 {
    color: #333;
    margin-bottom: 15px;
    font-size: 16px;
  }
  
  .info-box ol {
    color: #666;
    font-size: 14px;
    line-height: 1.6;
    padding-left: 20px;
  }
  
  .conversation-room {
    background: white;
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    max-width: 800px;
    width: 100%;
    min-height: 600px;
    display: flex;
    flex-direction: column;
  }
  
  .room-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid #f0f0f0;
  }
  
  .room-header h2 {
    color: #333;
    margin: 0;
  }
  
  .connection-status {
    font-size: 14px;
    color: #666;
  }
  
  .status-connected {
    color: #4caf50;
    font-weight: 600;
  }
  
  .status-connecting {
    color: #ff9800;
    font-weight: 600;
  }
  
  .status-disconnected {
    color: #f44336;
    font-weight: 600;
  }
  
  .audio-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
  }
  
  .agent-status {
    margin-top: 30px;
    font-size: 18px;
    color: #666;
  }
  
  .speaking-indicator {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #4caf50;
    font-weight: 600;
  }
  
  .pulse {
    display: inline-block;
    width: 12px;
    height: 12px;
    background: #4caf50;
    border-radius: 50%;
    animation: pulse 1.5s infinite;
  }
  
  @keyframes pulse {
    0% {
      box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);
    }
    70% {
      box-shadow: 0 0 0 10px rgba(76, 175, 80, 0);
    }
    100% {
      box-shadow: 0 0 0 0 rgba(76, 175, 80, 0);
    }
  }
  
  .listening-indicator {
    color: #2196f3;
    font-weight: 500;
  }
  
  .controls {
    padding: 20px;
    border-top: 2px solid #f0f0f0;
  }
  
  .text-input-section {
    margin-top: 20px;
    padding: 20px;
    background: #f7f9fc;
    border-radius: 10px;
  }
  
  .text-input-section input {
    width: 100%;
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 16px;
  }
  
  .text-input-section small {
    display: block;
    margin-top: 8px;
    color: #999;
  }
  
  .messages {
    margin-top: 20px;
    padding: 20px;
    background: #f7f9fc;
    border-radius: 10px;
    max-height: 200px;
    overflow-y: auto;
  }
  
  .messages h3 {
    margin-top: 0;
    color: #333;
    font-size: 16px;
  }
  
  .message {
    padding: 8px 12px;
    background: white;
    border-radius: 6px;
    margin-bottom: 8px;
    color: #555;
  }
  
  /* Override LiveKit default styles if needed */
  .lk-control-bar {
    background: #f7f9fc !important;
    border-radius: 10px !important;
    padding: 15px !important;
  }
  
  .lk-button {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    border-radius: 8px !important;
  }
  
  .lk-button:hover {
    transform: translateY(-2px);
  }

  .session-info {
    display: flex;
    gap: 20px;
    align-items: center;
    font-size: 14px;
    color: #666;
  }
  
  .session-id {
    font-family: monospace;
    background: #f0f0f0;
    padding: 4px 8px;
    border-radius: 4px;
  }
  
  .session-id code {
    color: #667eea;
    font-size: 12px;
  }
  
  .session-time {
    font-weight: 600;
    color: #333;
  }
  
  .tips {
    background: #f7f9fc;
    border-left: 4px solid #667eea;
    padding: 12px;
    margin: 20px;
    border-radius: 4px;
    color: #555;
    font-size: 14px;
  }
  
  .connecting-indicator {
    color: #ff9800;
    animation: fade 1.5s ease-in-out infinite;
  }
  
  @keyframes fade {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
  }
  
  .end-session-section {
    padding: 20px;
    text-align: center;
    border-top: 2px solid #f0f0f0;
  }
  
  .end-button {
    background: linear-gradient(135deg, #f44336 0%, #e91e63 100%);
    color: white;
    border: none;
    padding: 12px 30px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.3s, box-shadow 0.3s;
  }
  
  .end-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(244, 67, 54, 0.3);
  }
  
  .info-box ul {
    list-style: none;
    padding: 0;
    margin: 10px 0 0 0;
  }
  
  .info-box li {
    padding: 8px 0;
    border-bottom: 1px solid #f0f0f0;
  }
  
  .info-box li:last-child {
    border-bottom: none;
  }


================================================
File: src/App.tsx
================================================
// App.tsx - Replace your existing App.tsx with this
import React, { useState, useCallback, useEffect } from 'react';
import {
  LiveKitRoom,
  AudioConference,
  ControlBar,
  RoomAudioRenderer,
  useConnectionState,
  useRoomContext,
} from '@livekit/components-react';
import '@livekit/components-styles';
import './App.css';

// Configuration
const LIVEKIT_URL = import.meta.env.VITE_LIVEKIT_URL || 'ws://localhost:7880';
const ORCHESTRATOR_URL = import.meta.env.VITE_ORCHESTRATOR_URL || 'http://localhost:8080';

interface SessionInfo {
  sessionId: string;
  status: string;
  startTime: number;
}

function App() {
  const [token, setToken] = useState<string>('');
  const [serverUrl, setServerUrl] = useState<string>('');
  const [isConnecting, setIsConnecting] = useState(false);
  const [isConnected, setIsConnected] = useState(false);
  const [error, setError] = useState<string>('');
  const [userName, setUserName] = useState<string>('');
  const [sessionInfo, setSessionInfo] = useState<SessionInfo | null>(null);
  const [sessionId, setSessionId] = useState<string>('');

  // Start a new chat session
  const startSession = async () => {
    try {
      setIsConnecting(true);
      setError('');

      // Step 1: Request a new bot session
      console.log('Starting new bot session...');
      const botResponse = await fetch(`${ORCHESTRATOR_URL}/api/session/start`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          userId: `user-${Date.now()}`,
          userName: userName || 'Guest',
        }),
      });

      if (!botResponse.ok) {
        const errorData = await botResponse.json();
        throw new Error(errorData.message || 'Failed to start bot session');
      }

      const botData = await botResponse.json();
      console.log('Bot session started:', botData);
      setSessionId(botData.sessionId);
      setSessionInfo(botData.info);

      // Step 2: Get token for the user to join the same room
      console.log('Getting token for room:', botData.sessionId);
      const tokenResponse = await fetch(`${ORCHESTRATOR_URL}/api/token`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          sessionId: botData.sessionId,
          userName: userName || 'Guest',
        }),
      });

      if (!tokenResponse.ok) {
        const errorData = await tokenResponse.json();
        throw new Error(errorData.message || 'Failed to get token');
      }

      const tokenData = await tokenResponse.json();
      console.log('Token received, connecting to LiveKit...');
      
      setToken(tokenData.token);
      setServerUrl(tokenData.url || LIVEKIT_URL);
      setIsConnected(true);

    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to connect');
      console.error('Error starting session:', err);
    } finally {
      setIsConnecting(false);
    }
  };

  // End the current session
  const endSession = async () => {
    console.log('Ending session:', sessionId);
    
    // Tell orchestrator to stop the bot
    if (sessionId) {
      try {
        await fetch(`${ORCHESTRATOR_URL}/api/session/stop`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            sessionId: sessionId,
          }),
        });
      } catch (err) {
        console.error('Error stopping bot:', err);
      }
    }

    // Reset state
    setIsConnected(false);
    setToken('');
    setServerUrl('');
    setSessionId('');
    setSessionInfo(null);
  };

  // Check server status
  useEffect(() => {
    const checkHealth = async () => {
      try {
        const response = await fetch(`${ORCHESTRATOR_URL}/api/health`);
        const data = await response.json();
        console.log('Orchestrator status:', data);
      } catch (err) {
        console.error('Orchestrator not reachable:', err);
        setError('Cannot connect to orchestrator. Make sure it\'s running on port 8080');
      }
    };
    checkHealth();
  }, []);

  if (!isConnected) {
    return (
      <div className="app">
        <div className="connect-container">
          <h1>üé§ AI Voice Chat</h1>
          <p>Each conversation is completely private and isolated</p>
          
          <div className="connect-form">
            <div className="form-group">
              <label>Your Name (optional):</label>
              <input
                type="text"
                value={userName}
                onChange={(e) => setUserName(e.target.value)}
                placeholder="Enter your name or stay anonymous"
              />
            </div>

            <button 
              className="start-button"
              onClick={startSession}
              disabled={isConnecting}
            >
              {isConnecting ? 'üîÑ Starting your session...' : 'üöÄ Start Private Conversation'}
            </button>

            {error && (
              <div className="error-message">
                ‚ùå {error}
              </div>
            )}
            
            <div className="info-box">
              <h3>How it works:</h3>
              <ul>
                <li>‚úÖ Each user gets their own private AI assistant</li>
                <li>üîí Conversations are completely isolated</li>
                <li>‚è±Ô∏è Sessions auto-end after 30 minutes of inactivity</li>
                <li>üöÄ Up to 50 concurrent users supported</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="app">
      <LiveKitRoom
        token={token}
        serverUrl={serverUrl}
        connectOptions={{
          autoSubscribe: true,
        }}
        audio={true}
        video={false}
        onDisconnected={endSession}
      >
        <ConversationRoom 
          sessionId={sessionId}
          sessionInfo={sessionInfo}
          onEndSession={endSession}
        />
      </LiveKitRoom>
    </div>
  );
}

function ConversationRoom({ 
  sessionId, 
  sessionInfo,
  onEndSession 
}: { 
  sessionId: string;
  sessionInfo: SessionInfo | null;
  onEndSession: () => void;
}) {
  const connectionState = useConnectionState();
  const [elapsedTime, setElapsedTime] = useState<string>('00:00');

  // Update elapsed time every second
  useEffect(() => {
    if (!sessionInfo) return;

    const interval = setInterval(() => {
      const elapsed = Date.now() - sessionInfo.startTime;
      const minutes = Math.floor(elapsed / 60000);
      const seconds = Math.floor((elapsed % 60000) / 1000);
      setElapsedTime(`${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`);
    }, 1000);

    return () => clearInterval(interval);
  }, [sessionInfo]);

  return (
    <div className="conversation-room">
      <div className="room-header">
        <h2>ü§ñ Your Private AI Assistant</h2>
        <div className="session-info">
          <div className="session-id">
            Session: <code>{sessionId.substring(0, 20)}...</code>
          </div>
          <div className="connection-status">
            Status: <span className={`status-${connectionState.toLowerCase()}`}>
              {connectionState}
            </span>
          </div>
          <div className="session-time">
            Duration: {elapsedTime}
          </div>
        </div>
      </div>

      <div className="audio-container">
        <RoomAudioRenderer />
        <AudioConference />
        
        <div className="agent-status">
          {connectionState === 'connected' ? (
            <div className="listening-indicator">
              <span className="pulse"></span>
              AI Assistant is ready! Start speaking...
            </div>
          ) : (
            <div className="connecting-indicator">
              Connecting to your assistant...
            </div>
          )}
        </div>

        <div className="tips">
          üí° Tip: Speak naturally, as if talking to a friend. The AI will respond after you pause.
        </div>
      </div>

      <div className="controls">
        <ControlBar 
          variation="verbose"
          controls={{
            microphone: true,
            screenShare: false,
            camera: false,
            chat: false,
            leave: true,
          }}
          onLeave={onEndSession}
        />
      </div>

      <div className="end-session-section">
        <button 
          className="end-button"
          onClick={onEndSession}
        >
          üõë End Conversation
        </button>
      </div>
    </div>
  );
}

export default App;


================================================
File: src/index.css
================================================
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
      'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
      sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    background: #f5f5f5;
  }
  
  code {
    font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
      monospace;
  }
  
  #root {
    min-height: 100vh;
  }


================================================
File: src/main.tsx
================================================
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App'
import './index.css'

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)

